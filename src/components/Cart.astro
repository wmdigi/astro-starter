---
import CartIcon from "@icons/CartIcon.astro";

const locals = Astro.locals;
---

<script>
	import { $ } from "@wmdigi/dom";
	import { cart as cartStore } from "@store";
	import { products } from "@lib/data";
	import type { Product } from "@src/types/cart";

	$("#cart").addClass("server-loaded");

	const cart = cartStore.get()
	const cartCount = $("#cart").first.dataset.cart.length || 0

	// Update cart store
	console.log($("#cart").first.dataset.cart)
		//cartStore.set({ ...cart, products: [...cart.products, products.find((p: Product) => cart.products.includes(p.slug))] })

	cartStore.subscribe((cart) => {
		$("#cart-indicator").first.innerHTML = cartCount
	})
</script>

<a id="cart" href="/cart" class="relative" data-cart={locals.cart}>
	<CartIcon class:list={["w-8 text-black dark:text-white"]} />
	<span
		id="cart-indicator"
		class="absolute top-0 right-0 translate-x-1/3 -translate-y-1/3 w-4 h-4 flex items-center justify-center pt-px text-xs text-white dark:text-black bg-black dark:bg-white rounded-full opacity-0 server-loaded:opacity-100 server-loaded:motion-preset-expand"
	>
		{locals.cart.length}
	</span>
</a>